{% extends "base.html" %}
{% load static_asset %}
{% load static from staticfiles %}{% load assets %}
{% block title %}{{ group.name }}{% endblock %}
{% block active-nav-id %}nav-group{% endblock %}


{% block page_css %}
    {% assets "group_detail_css" %}
        <link href="{% static_asset ASSET_URL %}" media="screen" rel="stylesheet" type="text/css">
    {% endassets %}
    <link rel="stylesheet" href="{% static 'css/ui/jquery-ui-bootstrap/jquery-ui-1.8.16.bootstrap.css' %}">
    <style type="text/css">
        .error {
            margin: auto auto;
            width: auto;
            padding: 0px;
        }

        #div_id_logo .controls label {
            margin-left: 15px;;
            margin-top: 5px;;
        }

        #logo-clear_id {
            display: block;
            float: left;
            margin-top: 8px;;
        }

        #id_logo {
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            box-shadow: none;
        }

        form, .form-actions {
            margin-bottom: 0;
        }

        .form-horizontal .control-label {
            width: 60px;
        }

        .form-horizontal .controls {
            margin-left: 80px;
        }

        #div_id_logo {
            margin-top: 10px;;
        }


    </style>

{% endblock %}
{% block content %}

    <div id="banner-wrapper">
        <div id="banner" class="shadow">
            <img class="fl" src="{{ group.logo_url_default_if_none }}" alt="{{ group.name }}" width="96" height="96">
            {% if request.user == group.owner %}
                <a href="{% url edit_group_logo group.id %}" id="id_edit_logo_link" class="edit-link">
                    <img alt="修改" src="{% static "img/edit-pencil.png" %}">
                </a>
            {% endif %}
            <h1 class="group-name">{{ group.name }}</h1>

            {% if not request.user.is_authenticated or group not in request.user.interest_groups.all %}
                <a href="{% url join_group group.id %}" id="id_join_group_link" class="button">加入圈子</a>
            {% else %}
                <a href="" id="id_invite_friend_link" class="button">邀请好友</a>
                {#                <a href="{% url leave_group group.id %}" id="id_leave_group_link" class="button">离开圈子</a>#}
            {% endif %}
        </div>
    </div>
    <div class="left-column">
        <div class="meal-cell">
            <a href=""></a>

            <img class="meal-cover" alt="Vietnamese Grubs in Lincoln Park" height="200"
                 src="https://d1gwxpes5z0r7f.cloudfront.net/grub_meal_pics/4955/matte/30748_724397484471_1390067_n.jpg?2012"
                 width="228">

            <div class="price-seat">
                $15 - Chicago, IL- 13 seats left
            </div>

            {#            TODO只显示5个#}
            <div class="users">
                <img alt="Karthik Balasubramanian"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/3672/size_30x30/prof%20pic.jpg?2012">
                <img alt="Glen Kato"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/3827/size_30x30/me-and-mryellow_mini.jpg?2012">
                <img alt="Julie Corvo"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/40900/size_30x30/40900/540397_947202850792_857084844_n.jpg">
                <img alt="Nikkie H"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/17014/size_30x30/LinkedIn%20Photo.JPG?2012">
                <img alt="Mark Tudela"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/1456/size_30x30/1456_pic20110521-1-89sb73-0.?2012">
                <img alt="Brittany R"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/48377/size_30x30/48377_pic20120622-16-retfhn.?2012">
            </div>

            <div class="info">
                <h3>Vietnamese Grubs in Park</h3>
                <span class="date"> Thursday, September 06,  7:30PM </span>
            </div>
        </div>
        <hr>
        <h4>Past Meals</h4>

        <div class="meal-cell">
            <a href=""></a>

            <img class="meal-cover" alt="Vietnamese Grubs in Lincoln Park" height="200"
                 src="https://d1gwxpes5z0r7f.cloudfront.net/grub_meal_pics/4955/matte/30748_724397484471_1390067_n.jpg?2012"
                 width="228">

            <div class="price-seat">
                $15 - Chicago, IL- 13 seats left
            </div>

            {#            TODO只显示5个#}
            <div class="users">
                <img alt="Karthik Balasubramanian"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/3672/size_30x30/prof%20pic.jpg?2012">
                <img alt="Glen Kato"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/3827/size_30x30/me-and-mryellow_mini.jpg?2012">
                <img alt="Julie Corvo"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/40900/size_30x30/40900/540397_947202850792_857084844_n.jpg">
                <img alt="Nikkie H"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/17014/size_30x30/LinkedIn%20Photo.JPG?2012">
                <img alt="Mark Tudela"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/1456/size_30x30/1456_pic20110521-1-89sb73-0.?2012">
                <img alt="Brittany R"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/48377/size_30x30/48377_pic20120622-16-retfhn.?2012">
            </div>

            <div class="info">
                <h3>Vietnamese Grubs in Park</h3>
                <span class="date"> Thursday, September 06,  7:30PM </span>
            </div>
        </div>

        <div class="meal-cell">
            <a href=""></a>

            <img class="meal-cover" alt="Vietnamese Grubs in Lincoln Park" height="200"
                 src="https://d1gwxpes5z0r7f.cloudfront.net/grub_meal_pics/4955/matte/30748_724397484471_1390067_n.jpg?2012"
                 width="228">

            <div class="price-seat">
                $15 - Chicago, IL- 13 seats left
            </div>

            {#            TODO只显示5个#}
            <div class="users">
                <img alt="Karthik Balasubramanian"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/3672/size_30x30/prof%20pic.jpg?2012">
                <img alt="Glen Kato"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/3827/size_30x30/me-and-mryellow_mini.jpg?2012">
                <img alt="Julie Corvo"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/40900/size_30x30/40900/540397_947202850792_857084844_n.jpg">
                <img alt="Nikkie H"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/17014/size_30x30/LinkedIn%20Photo.JPG?2012">
                <img alt="Mark Tudela"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/1456/size_30x30/1456_pic20110521-1-89sb73-0.?2012">
                <img alt="Brittany R"
                     src="https://d1gwxpes5z0r7f.cloudfront.net/grub_user_pics/48377/size_30x30/48377_pic20120622-16-retfhn.?2012">
            </div>

            <div class="info">
                <h3>Vietnamese Grubs in Park</h3>
                <span class="date"> Thursday, September 06,  7:30PM </span>
            </div>
        </div>

    </div>
    <div class="right-column">
        <div class="about">
            {% comment %} <h3>About Chicago 20s and 30s Grub Group (Chicago)
                </h3>{% endcomment %}


            <div class="desc">
                {{ group.desc }}
            </div>
            {% if request.user == group.owner %}
                <a href="{% url edit_group group.id%}" class="edit-link">
                    <img alt="修改" src="{% static "img/edit-pencil.png" %}">
                </a>
            {% endif %}
            {% if group.category %}
                <div class="taglist clearfix">
                    <a href="#" class="tag">{{ group.category.name }}</a>
                </div>
            {% endif %}
        </div>
        <div class="members-wrapper">
            {% with members_count=group.members.count %}
                <h3>{{ members_count }} 位成员
                    {% if members_count > 21 %}
                        <a class="see-all" href="/groups/20sgrubgroup/members">(查看所有)</a>
                    {% endif %}
                    {% if group in request.user.interest_groups.all and request.user != group.owner %}
                        | <a href="{% url leave_group group.id %}" id="id_leave_group_link">离开</a>
                    {% endif %}
                </h3>

                <div class="members clearfix">
                    <span class="owner">创建者</span>
                    {% for member in group.members.all|slice:":21" %}
                        <a href="" class="user-avatar" title="{{ member.username }}">
                            <img alt="{{ member.username }}" width="40" height="40"
                                 src="{{ MEDIA_URL }}{{ member.get_profile.avatar_default_if_none  }}">
                        </a>
                    {% endfor %}
                </div>
                <br clear="all">
            {% endwith %}
        </div>
        <div class="comments">
            <h3>Join the Conversation!</h3>


            <div class="wrapper-for-group-comments">

                <div class="join-to-comment">您需要登录才能加入会话！</div>

                <div id="comments-wrapper">
                    {% for comment in group.comments.all %}
                        <div class="parent-comment clearfix" id="comment_9366">
                            <a href="{% url user_detail comment.from_person.id %}"><img
                                    alt="{{ comment.from_person.user.username }}" width="75" height="75"
                                    src="{{ MEDIA_URL }}{{ comment.from_person.avatar_default_if_none  }}"></a>

                            <div class="comment-content">
                                <h3><a href="{% url user_detail comment.from_person.id %}">{{ comment.from_person.user.username }}</a> </h3>

                                <div class="comment-widget">
		<span>about 11 hours ago
		</span>
                                </div>
                                <p>{{ comment.comment }}</p>

                                <div id="comment_9366_replies">

                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    <div class="meals_pagination" id="comments-pagination">

                    </div>

                </div>

            </div>

        </div>
    </div>




















    {% comment %}    圈子详情<br/>
    名称:{{ group.name }}<br/>
    描述{{ group.desc }}<br/>
    分类：{{ group.category.name }}<br/>
    公开：{{ group.privacy }}<br/>
    创建者：{{ group.owner }}

    {% ifequal request.user group.owner %}
        <a href="{% url edit_group group.id %}">修改圈子信息</a>
        <a href="{% url edit_group_logo group.id %}" id="id_edit_logo_link">修改Logo</a>
    {% endifequal %}
    {% if request.user in group.members.all %}
        <a href="{% url leave_group group.id %}" id="id_leave_group_link">离开圈子</a>
    {% else%}
        <a href="{% url join_group group.id %}" id="id_join_group_link">加入圈子</a>
    {% endif %}{% endcomment %}



    <div id="id_edit_logo_dialog" class="hide">

    </div>

{% endblock %}
{% block base_js %}
    {{ block.super }}
    {% assets "jquery_ui_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}
    {% assets "jquery_form_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}
{% endblock %}
{% block page_js %}
    <script type="text/javascript">
        function loadEditLogoPage() {
            $("#id_create_group_form").ajaxForm({
                success:function (html) {
                    var $html = $(html);
                    if ($html.is("a.auto-close") && $html.attr('href')) {
                        window.location.href = $html.attr('href');
                    } else {
                        $("#id_edit_logo_dialog").html($html.find(".content"));
                        loadEditLogoPage();
                    }
                }
            })
            $("#id_edit_logo_dialog").dialog({
                autoOpen:true,
                title:"修改Logo",
                modal:true,
                width:440,
                height:260,
                position:['center', 100],
                resizable:false
            });
            $("<br/>").insertBefore($("#logo-clear_id"));
            $("input[type=submit]").focus()
        }
        $(document).ready(function () {
            $("#id_edit_logo_link").click(function () {
                $("#id_edit_logo_dialog").load($("#id_edit_logo_link").attr('href') + " .content", loadEditLogoPage);
                return false;
            });
            $("#id_join_group_link,#id_leave_group_link").click(function () {
                $.post($(this).attr('href'), function (data) {
                    if (data.status == "OK") {
                        window.location = '{{  request.path }}';
                    }
                });
                return false;
            })
        })
    </script>
{% endblock %}