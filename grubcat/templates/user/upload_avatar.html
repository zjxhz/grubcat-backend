{% extends "base.html" %}
{% load static from staticfiles %}{% load assets %}{% load static_asset %}
{% block page_css %}
    {{ block.super }}
    {{ form.media.css }}
    <style type="text/css">

    #crop_area{
        width: 430px;
        float: left;
    }
        .preview-container {
            overflow: hidden;
        }

        #cropping-tip{
            margin-top: 60px;
            color: #ff471d;
        }

        #preview_big_container {
            width: 200px;
            height: 200px;
            float: left;
            margin-right: 40px;
            margin-top: 20px;
        }

        #preview_middle_container {
            width: 100px;
            height: 100px;
            margin-top: 20px;
        }

        #preview_small_container {
            width: 30px;
            height: 30px;
            margin-top: 40px;
        }
    </style>
{% endblock %}
{% block page_js %}
    {{ block.super }}
{#    {{ form.media.js }}#}
    {% assets "image_cropping_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}
    <script type="text/javascript">
        function showPreview(coords) {
            var rxBig = 200 / coords.w;
            var ryBig = 200 / coords.h;
            var rxMiddle = 100 / coords.w;
            var ryMiddle = 100 / coords.h;
            var rxSmall = 30 / coords.w;
            var rySmall = 30 / coords.h;

            $('#preview_big').css({
                width:Math.round(rxBig * $("#id_avatar").data('org-width')) + 'px',
                height:Math.round(ryBig * $("#id_avatar").data('org-height')) + 'px',
                marginLeft:'-' + Math.round(rxBig * coords.x) + 'px',
                marginTop:'-' + Math.round(ryBig * coords.y) + 'px'
            });
            $('#preview_middle').css({
                width:Math.round(rxMiddle * $("#id_avatar").data('org-width')) + 'px',
                height:Math.round(ryMiddle * $("#id_avatar").data('org-height')) + 'px',
                marginLeft:'-' + Math.round(rxMiddle * coords.x) + 'px',
                marginTop:'-' + Math.round(ryMiddle * coords.y) + 'px'
            });
            $('#preview_small').css({
                width:Math.round(rxSmall * $("#id_avatar").data('org-width')) + 'px',
                height:Math.round(rySmall * $("#id_avatar").data('org-height')) + 'px',
                marginLeft:'-' + Math.round(rxSmall * coords.x) + 'px',
                marginTop:'-' + Math.round(rySmall * coords.y) + 'px'
            });
        }
        image_cropping.update_selection = function ($crop_field) {
            return function (sel) {
                image_cropping._update_selection(sel, $crop_field);
                showPreview(sel);
            };


        }

    </script>
{% endblock %}

{% block content %}
    <div id="crop_area">
        <form action="" method="post" enctype="multipart/form-data">
            {{ form.avatar }}

            <br/>
            选择合适的区域做为头像：{{ form.cropping }}
            <input type="submit" value="保存">
        </form>
    </div>
    <div id="cropping-tip">
        您上传的头像会自动生成三种尺寸，<br/>请注意不同大小尺寸的头像是否清晰
    </div>
    <div id="preview_big_container" class="preview-container">
        <img id="preview_big" src="{{ form.instance.avatar.url }}">
    </div>
    <div id="preview_middle_container" class="preview-container">
        <img id="preview_middle" src="{{ form.instance.avatar.url }}">
    </div>
    <div id="preview_small_container" class="preview-container">
        <img id="preview_small" src="{{ form.instance.avatar.url }}">
    </div>
{% endblock %}

