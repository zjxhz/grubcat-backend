{% extends "base.html" %}

{% load bootstrap_tags %}
{% load static from staticfiles %}{% load assets %}
{% block title %}发起饭局{% endblock %}
{% block page_css %}
    {{ block.super }}
    {#    TODO don't use juqery ui#}
    <link rel="stylesheet" href="{% static 'css/ui/jquery-ui-bootstrap/jquery-ui-1.8.16.bootstrap.css' %}">
    <link rel="stylesheet" href="{% static 'css/lionbars.css' %}">
    {% assets "meal_css" %}
        <link href="{% static ASSET_URL %}" media="screen" rel="stylesheet" type="text/css">
    {% endassets %}
{% endblock %}

{% block page_js %}
    <script type="text/javascript" src="{% static "js/jquery.lionbars.0.3.js" %}"></script>
    {% assets "jquery_ui_js" %}
        <script type="text/javascript" src="{% static ASSET_URL %}"></script>
    {% endassets %}
    {{ block.super }}
    {% assets "jquery_dropkick_js" %}
        <script type="text/javascript" src="{% static ASSET_URL %}"></script>
    {% endassets %}
    {% assets "module_js" %}
        <script type="text/javascript" src="{% static ASSET_URL %}"></script>
    {% endassets %}
    <script type="text/javascript">
        {% comment %}            {% if my_groups %}
       var group_privacy_josn = { {% for group in my_groups %}{{ group.id}}:{{ group.privacy }},{% endfor %} };
       $("#id_group").dropkick({
               change:false,
               width:313,
               startSpeed:0,
               change:function (group_id, label) {
                   if (!group_id) { //no grouop selected, show privacy select
                       $("#dk_container_id_privacy").dropkick('reset');
                       $("#dk_container_id_privacy").show();
                       $("#privacy-text").hide();
                       $("#id_privacy").val(0);
                   } else{
                       var privacy = group_privacy_josn[group_id];
                       $("#dk_container_id_privacy").hide();
                       $("#id_privacy").val(privacy);

                       var privacy_text=$("#id_privacy option[value=" + privacy + "]").text();
                       if( privacy == 0 ) { //public
                           privacy_text += " （圈子是公开类型）"
                       } else if(privacy == 1) {// private
                           privacy_text += " （圈子是私密类型）"
                       }

                       if($("#privacy-text")[0])
                       {
                           $("#privacy-text").text(privacy_text).show();
                       } else {
                           $("#id_privacy").before("<span id='privacy-text'>" +  privacy_text + "</span>");
                       }
                   }
               }
           }
       )


       var $current_group = $("#dk_container_id_group li.dk_option_current a");
       if($current_group.attr("data-dk-dropdown-value"))
       {
           $current_group.click();
       } else {
           {% if request.GET.group %}
               $("#dk_container_id_group li a[data-dk-dropdown-value=" + {{ request.GET.group }} + "]").click();
           {% endif %}
       }
       {% endif %}{% endcomment %}
    </script>
{% endblock %}

{% block content %}
    <div id="create-meal-page">
        <div class="form-wrapper span10 offset1">
            <form id="create_meal_form" action="{% url create_meal %}" method="post"
                  class="form form-horizontal"> {% csrf_token %}
                <fieldset>

                    <legend>发起一个饭局</legend>

                    <div class="control-group ">

                        <label class="control-label" for="id_topic">饭局主题</label>

                        <div class="controls">
                            {{ form.topic }} {{ form.topic.errors }}
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label" for="id_introduction">饭局简介</label>

                        <div class="controls">
                            {{ form.introduction }} {{ form.introduction.errors }}
                        </div>
                    </div>


                    {#            </fieldset>#}

                    {#            <fieldset class="full">#}

                    {#                <legend>2、餐厅信息</legend>#}
                    <div class="control-group start_time">
                        <label class="control-label" for="id_privacy">就餐时间</label>

                        <div class="controls">
                            {{ form.start_date }} {{ form.start_time }}
                            {{ form.start_date.errors }} {{ form.start_time.errors }}
                        </div>
                    </div>
                    <div class="control-group min_persons">
                        <label class="control-label" for="id_min_persons">就餐人数</label>

                        <div class="controls">
                            {{ form.min_persons }} {{ form.min_persons.errors }}
                        </div>
                    </div>
                    <div id="choose-menu-container">
                        <div id="loading-menus" class="hide"><img alt="载入菜单"
                                                                  src="{% static "img/loading-menus.gif" %}"/>
                        </div>
                        <div id="choose-menu-wrapper"></div>
                    </div>
                </fieldset>
                {{ form.menu_id }}
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-create-meal">确定</button>
                </div>
            </form>
        </div>

        <div id="choose-restaurant-msg" style="display: none">

            {% if form.menu_id.errors %}
                {{ form.menu_id.errors }}
            {% else %}
                左边是热门的餐厅和菜单<br/>您可以选择一个查看详情
            {% endif %}
        </div>
        <div id="data" menu-list-link="{% url menu_list %}"></div>
    </div>
{% endblock %}
{% block active-nav-id %}nav-create-meal{% endblock %}