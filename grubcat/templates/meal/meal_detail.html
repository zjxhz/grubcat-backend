{% extends "base.html" %}
{% load static_asset %}
{% load static from staticfiles %}{% load assets %}
{% block title %}{{ meal.topic }}{% endblock %}
{% block page_css %}
    {{ block.super }}
    {% assets "meal_css" %}
        <link href="{% static_asset ASSET_URL %}" media="screen" rel="stylesheet" type="text/css">
    {% endassets %}
{% endblock %}
{#{% block active-nav-id %}nav-meal{% endblock %}#}
{% block content %}
    <div id="meal-detail" class="span9">
        <div id="title" class="box-seperator clearfix">

            <h1>{{ meal.topic }}</h1>
                <span id="restaurant-location"><a href="http://maps.google.com.hk?q={{ meal.menu.restaurant.name }}"
                                                  target="_blank"
                                                  class="restaurant-name">{{ meal.menu.restaurant.name }}</a> {{ meal.menu.restaurant.address }}</span>
           <span class="date fr">{{ meal.start_date|date:"n" }}月{{ meal.start_date|date:"j" }}日 {{ meal.start_date|date:"D" }}
               {{ meal.start_time|date:"G:i " }}</span>
        </div>
        <p id="desc">{{ meal.introduction }}</p>

        <div id="meal-container" class="clearfix box-seperator">
            <div id="meal-img-wrapper">
                <img alt="{{ meal.topic }}" id="meal-photo"
                     src="{{ meal.get_cover_url }}"
                     width="420" height="280">
            </div>
            <div id="meal-grub">
{#                {% if not request.user.get_profile in meal.participants.all %}#}
            {% if meal.left_persons == 0 %}
                <a href=""
                   class="btn btn-book btn-sold-out fr btn-disabled">
                    卖光了
                    {#                        <span class="mt5">{{ meal.list_price }}RMB/人</span>#}
                </a>
                {% elif not order %}
                    <a href="#"
                       class="btn btn-primary btn-book fr">
                        马上预定
                        {#                        <span class="mt5">{{ meal.list_price }}RMB/人</span>#}
                    </a>
                    <form id="order_info_form" method="post" class="form-horizontal"> {% csrf_token %}
                    <fieldset>
                        {% for hidden in form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        <div class="control-group num_persons">
                            <label class="control-label" for="id_num_persons">为几人付款:</label>

                            <div class="controls">
                                {{ form.num_persons }}
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">价钱:</label>

                            <div class="controls">
                                <label><span id="meal_price">{{ meal.list_price }}</span> 元/人</label>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="control-label">总价钱:</label>

                            <div class="controls">
                                <label><span id="total_price" class="bl">{{ meal.list_price }}</span> 元</label>
                            </div>
                        </div>
                    </fieldset>
                </form>
                {% else %}
                    <a href="{% url order_detail meal.id order.id %}"
                       class="btn btn-primary btn-book btn-booked fr">
                        已预订 查看订单
                    </a>
                {% endif %}



            </div>

        </div>
        <div id="users" class="clearfix">
            {% if meal.actual_persons %}
                <h3>还剩{{ meal.left_persons }}个空位</h3>
            {% else %}
                <h3>现在还没有人参加饭局，赶快预定吧！</h3>
            {% endif %}
            <ul class="thumbnails">
                {% for user in meal.participants.all %}
                    <li class="user-wrapper span3">
                        {#                    <h3 class="name">{{ user.user.username}}</h3>#}

                        {#                    <p class="work">{{ user.occupation|default:"" }}</p>#}
                        <a href="{% url user_detail user.id %}" class="thumbnail" title="{{ user.user.username }}">
                            <img alt="{{ user.user.username }}" class="user-pic" width="220"
                                 height="220"
                                 src="{{ user.big_avatar }}">
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% comment %}  <div style="display: none">
        <div id="menu-popup">
            <div id="menu-container">
                <div class="ribbon ribbon-menu ribbon-notail">
                    <div class="ribbon-right"></div>
                    <div class="ribbon-title">
                        Entrees&nbsp;
                    </div>
                </div>

                <div class="content italic clearfix">
                    {% for dish in meal.order.dishes.all %}
                        <div class="dish-pic"><img src="{{ dish.pic }}" width="50" height="50"></div>
                        <div class="dish-content"><h3>{{ dish.name }}</h3></div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <div class="sidebar fr">

        <div id="menu" class="menu sidebar-box">
            <div class="sidebar-box-title">菜单 {{ meal.menu.name|default:"8人套餐 40元/人" }}</div>
            <div class="sidebar-box-inner">
                <div id="menu-info" class="">
                    {#                            <div class="title">#}
                    {#                                <div class="menu-name">{{ menu.name|default:"8人套餐 40元/人" }}</div>#}
                    {#                            </div>#}

                    <dl class="menu-items">
                        {% for item in meal.menu.items %}
                            {% if item.num %}
                                <dd class="dish"><span class="dish-name">{{ item.dish.name }}</span>
                                <span class="dish-info"> <span class="dish-price">{{ item.dish.price }} 元</span><span
                                        class="unit"> /{{ item.dish.unit }} &times; </span><span
                                        class="num">{{ item.num }}</span> </span>
                                </dd>
                            {% else %}
                                <dt class="category">{{ item.category.name }}  </dt>
                            {% endif %}
                        {% endfor %}
                    </dl>
                </div>
            </div>
        </div>
{#        {% include "support/faq_sidebar.html" %}#}
    </div>{% endcomment %}

{% endblock %}

{% block page_js %}
    {{ block.super }}
    {% comment %}    {% assets "jquery_dropkick_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}{% endcomment %}
    {% assets "module_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}
    <script type="text/javascript">
        $(document).ready(function () {

            {% comment %}$("#faq .sidebar-box-inner a").click(function () {
                var $next = $(this).next("p");
                var speed = 100;
                if ($next.is(":visible")) {
                    $(this).next("p").slideUp(speed);
                } else {
                    $(this).siblings("p:visible").slideUp(speed);
                    $(this).next("p").slideDown(speed);
                }
            }){% endcomment %}
        })
    </script>
{% endblock %}