{% extends "base.html" %}
{% load static_asset %}
{% load static from staticfiles %}{% load assets %}
{% block title %}{{ meal.topic }}{% endblock %}
{% block page_css %}
    {{ block.super }}
    {% assets "meal_css" %}
        <link href="{% static_asset ASSET_URL %}" media="screen" rel="stylesheet" type="text/css">
    {% endassets %}
{% endblock %}
{#{% block active-nav-id %}nav-meal{% endblock %}#}
{% block content %}
    <div class="row" id="meal-detail-page">
        <div id="meal-detail" class="span9">
            <div class="meal-simple-info box-seperator clearfix">

                <h1>{{ meal.topic }}</h1>
                <span id="restaurant-location"><a href="http://maps.google.com.hk?q={{ meal.menu.restaurant.name }}"
                                                  target="_blank"
                                                  class="restaurant-name">{{ meal.menu.restaurant.name }}</a> {{ meal.menu.restaurant.address }}</span>
           <span class="date fr">{{ meal.start_date|date:"n" }}月{{ meal.start_date|date:"j" }}日 {{ meal.start_date|date:"D" }}
               {{ meal.start_time|date:"G:i " }}</span>
            </div>
            <p id="desc">{{ meal.introduction }}</p>

            <div id="meal-container" class="clearfix box-seperator">
                <div class="meal-img-wrapper">
                    <img alt="{{ meal.topic }}" class="img-polaroid"
                         src="{{ meal.get_cover_url }}"
                         width="420" height="250">
                </div>
                <div id="meal-grub">
                    {% if not order and meal.left_persons > 0 %}
                        {% if user.is_authenticated %}
                            <a href="#"
                               class="btn btn-primary btn-book btn-book-now fr">
                                马上预定
                            </a>
                        {% else %}
                            <a href="{% url login %}?next={% url meal_detail meal.id %}"
                               class="btn btn-primary btn-book fr">
                                马上预定
                            </a>
                        {% endif %}
                        <form id="order_info_form" method="post" class="form-horizontal"> {% csrf_token %}
                            <fieldset>
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                                <div class="control-group num_persons">
                                    <label class="control-label" for="id_num_persons">为几人付款:</label>

                                    <div class="controls">
                                        {{ form.num_persons }}
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label class="control-label">单价:</label>

                                    <div class="controls">
                                        <label>¥ <span id="meal_price">{{ meal.list_price }}</span></label>
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label class="control-label">总价:</label>

                                    <div class="controls">
                                        <label>¥ <span id="total_price" class="bl">{{ meal.list_price }}</span> </label>
                                    </div>
                                </div>
                            </fieldset>
                        </form>

                    {% elif not order and meal.left_persons <= 0 %}
                        <a href=""
                           class="btn btn-book btn-sold-out fr">
                            卖光了
                            {#                        <span class="mt5">{{ meal.list_price }}RMB/人</span>#}
                        </a>
                    {% else %}
                        <a href="{% url order_detail meal.id order.id %}"
                           class="btn btn-primary btn-book btn-booked fr">
                            已预订 查看订单
                        </a>
                    {% endif %}


                </div>

            </div>
            <div id="users" class="">
                {% if meal.actual_persons %}
                    {% if meal.left_persons <= 0 %}
                        <h3>没有空位了！</h3>
                    {% else %}
                        <h3>还剩{{ meal.left_persons }}个空位，快来预定吧！</h3>
                    {% endif %}
                {% else %}
                    <h3>现在还没有人参加饭局，赶快预定吧！</h3>
                {% endif %}
                {% for user in meal.participants.all %}
                    <a href="{% url user_detail user.id %}" class=" user-img-wrapper"
                       title="{{ user.user.username }}">
                        <img alt="{{ user.user.username }}" width="80"
                             height="80"
                             src="{{ user.normal_avatar }}">
                    </a>
                {% endfor %}

                {% for empty_user in avaliable_seats %}
                    <img class="seat-placeholder" width="80"
                         height="80"
                         src="{% static 'img/default/seat-placeholder.png' %}">
                {% endfor %}

            </div>
        </div>
        <div class="sidebar span3  visible-desktop">

            {% include "support/faq_sidebar.html" %}

            <div id="menu" class="menu sidebar-box">
                <div class="sidebar-box-title">
                    菜单 {% comment %}{{ meal.menu.name|default:"8人套餐 40元/人" }}{% endcomment %}</div>
                <div class="sidebar-box-content">
                    <dl class="menu-items">
                        {% for item in meal.menu.items %}
                            {% if item.num %}
                                <dd class="dish">
                                    <span class="dish-name">{{ item.dish.name }}</span>
                                     <span class="dish-info">¥ <span class="dish-price">{{ item.dish.price }}</span>{% comment %}  <span
                                        class="unit"> /{{ item.dish.unit }} </span> &times;<span
                                        class="num">{{ item.num }}</span> {% endcomment %}</span>
                                </dd>
                            {% else %}
                                <dt class="category">{{ item.category.name }}  </dt>
                            {% endif %}
                        {% endfor %}
                    </dl>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block page_js %}
    {{ block.super }}
    {% assets "module_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}
{% endblock %}