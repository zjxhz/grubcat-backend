{% extends "restaurant/base.html" %}
{% load static from staticfiles %}
{% load assets %}
{% load static_asset %}
{% block title %}套餐管理{% endblock %}
{% block page_css %}
    <link rel="stylesheet" href="{% static 'css/ui/smoothness/jquery-ui-1.8.21.custom.css' %}">
    {{ block.super }}
    <style>
        dt, dd {
            height: 1.5em;
        }

        dt{
            margin-top: 10px;
        }

        .helper {
            border: 1px solid #000000;
            padding: 2px;
        }
    </style>
{% endblock %}
{% block page_js %}
    {% assets "jquery_ui_js" %}
        <script type="text/javascript" src="{% static_asset ASSET_URL %}"></script>
    {% endassets %}
    {{ block.super }}
    <script>
        function helperMasker() {
            return $(this).clone().addClass("helper").css("width", $(this).width())
        }

        function hideDishes(dishId) {
            $("#dish-container [dish-id=" + dishId + "]").hide();
//            $.each($("#dish-container [dish-id=" + dishId +"]").hide(), function(i, item){
//                if(!$(item).siblings("dd:visible")[0])
//                {
//                    $(item).siblings("dt:visible").fadeOut(1000);
//                }
//            });
        }

        function showDishes(dishId) {
            $("#dish-container [dish-id=" + dishId + "]").fadeIn(1000);
        }

        $(function () {

            //drag category
            $("#dish-container dt, #dish-container dd").draggable({
                connectToSortable:"#menu-container",
                revert:"invalid",
                helper:helperMasker,
                cursor:"move",
                opacity:0.35
            });

            $("#menu-container").sortable({
                cursor:"move",
                placeholder:"ui-state-highlight",
                forcePlaceholderSize:true,
                containment:"#menu-container",
//                receive:function (e, ui) {
//
//                    ui.item.fadeOut().fadeIn()
//                    var categoryId = ui.sender.attr('category-id');
////                    if($(this).find('dt[category-id=' +categoryId + ']').size()>=2)
////                    {
//////                       ui.sender.css('color','red').sortable('cancel');
////                    }
//                }
                receive:function (e, ui) {

                    hideDishes(ui.sender.attr("dish-id"));
                }
            });

//            $("#menu-container dl.category").sortable({
//                cursor:"move",
//                placeholder:"ui-state-highlight",
//                connectWith:"#menu-container dl.category",
//                items:"dd",
//                revert:"invalid",
//                receive:function (e, ui) {
//                    hideDishes(ui.sender.attr("dish-id"));
//                }
//            });

            $("#menu-container dt").live('dblclick', function (e) {
                $(this).fadeOut(1000).remove();
            })

            $("#menu-container dd").live('dblclick', function (e) {
                $(this).fadeOut(1000).remove();
                showDishes($(this).attr("dish-id"))
            })

            $("body").disableSelection();
        });
    </script>
{% endblock %}

{% block content %}
    <div class="well">
        请拖动左边的菜到右边的框中：（未全部完成）
    </div>

    <div class="row">
        <div id="dish-container" class="span5">
            <dl class="category">
                {% for category in categories %}
                    <dt class="category" category-id="{{ category.id }}">{{ category.name }}</dt>
                    {% for dish in dishes %}
                        {% if category in dish.categories.all %}
                            <dd id="{{ category.id }}-{{ dish.id }}" dish-id="{{ dish.id }}">{{ dish.name }}</dd>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </dl>
        </div>
        <div id="menu-container" class="span5">
            {#            <dl class="category">#}
            {#                <dt>热菜</dt>#}
            {#                <dd>11</dd>#}
            {#            </dl>#}
            {#            <dl class="category">#}
            {#                <dt>冷菜</dt>#}
            {#                <dd>21</dd>#}
            {#            </dl>#}
            {##}
            {#            <dl class="category">#}
            {#                <dt>海鲜</dt>#}
            {#                <dd>31</dd>#}
            {#            </dl>#}

        </div>
    </div>
    <div id="nav-active-id" style="display: none">nav-menu</div>
{% endblock %}